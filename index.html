<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="container">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email">
  <button onclick="login()">Login</button>
</div>

<script>
const SUPABASE_URL = "https://glhrtvlhqgamjaqwwehe.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsaHJ0dmxocWdhbWphcXd3ZWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxOTQ4NjYsImV4cCI6MjA4NTc3MDg2Nn0.2w9PaGy7kTKmJ9oBUxZ_E8awGViyYvDZEt1FxrpCQ4Y";


const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true
  }
});

// ✅ If already logged in → go to schemes
db.auth.onAuthStateChange((event, session) => {
  if (session) {
    window.location.href = "schemes.html";
  }
});

async function login() {
  const email = document.getElementById("email").value;

  const { error } = await db.auth.signInWithOtp({
    email: email,
    options: {
      emailRedirectTo: window.location.origin + "/schemes.html"
    }
  });

  if (error) {
    alert("Login failed");
    console.error(error);
  } else {
    alert("Magic link sent to your email!");
  }
}
</script>

</body>
</html>
