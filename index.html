<!DOCTYPE html>
<html>
<head>
  <title>Login - Scheme Finder</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<h2>Login</h2>
<input type="email" id="email" placeholder="Enter email">
<button onclick="login()">Login</button>

<script>
const SUPABASE_URL = "https://glhrtvlhqgamjaqwwehe.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsaHJ0dmxocWdhbWphcXd3ZWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxOTQ4NjYsImV4cCI6MjA4NTc3MDg2Nn0.2w9PaGy7kTKmJ9oBUxZ_E8awGViyYvDZEt1FxrpCQ4Y";

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

window.login = async function () {
  const email = document.getElementById("email").value;

  const { error } = await db.auth.signInWithOtp({ email });

  if (error) {
    alert("Login failed");
  } else {
    alert("Check your email and open the magic link.");
  }
};

// ðŸ”¥ After redirect from magic link, check profile
async function checkProfile() {
  const { data: userData } = await db.auth.getUser();

  if (!userData.user) return;

  const userId = userData.user.id;

  const { data: profile } = await db
    .from("profiles")
    .select("*")
    .eq("id", userId)
    .single();

  if (profile) {
    window.location.href = "schemes.html";
  } else {
    window.location.href = "profile.html";
  }
}

checkProfile();
</script>

</body>
</html>
