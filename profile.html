<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="navbar">
  <h3>Scheme Finder</h3>
  <div class="nav-links">
    <a href="schemes.html">Schemes</a>
    <a href="profile.html">Profile</a>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">
  <h2 id="title">Create Profile</h2>

  <input type="text" id="name" placeholder="Full Name">
  <input type="number" id="age" placeholder="Age">
  <input type="number" id="income" placeholder="Annual Income">

  <select id="gender">
    <option value="">Select Gender</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="other">Other</option>
  </select>

  <select id="caste">
    <option value="">Select Caste</option>
    <option value="general">General</option>
    <option value="obc">OBC</option>
    <option value="sc">SC</option>
    <option value="st">ST</option>
  </select>

  <select id="state">
    <option value="">Select State</option>
    <option value="tamil nadu">Tamil Nadu</option>
    <option value="kerala">Kerala</option>
    <option value="karnataka">Karnataka</option>
    <option value="andhra pradesh">Andhra Pradesh</option>
    <option value="telangana">Telangana</option>
    <option value="maharashtra">Maharashtra</option>
    <option value="delhi">Delhi</option>
  </select>

  <button onclick="saveProfile()">Save Profile</button>
</div>

<script>
const SUPABASE_URL = "https://glhrtvlhqgamjaqwwehe.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsaHJ0dmxocWdhbWphcXd3ZWhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxOTQ4NjYsImV4cCI6MjA4NTc3MDg2Nn0.2w9PaGy7kTKmJ9oBUxZ_E8awGViyYvDZEt1FxrpCQ4Y";

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function loadProfile() {
  const { data: { user } } = await db.auth.getUser();
  if (!user) return location.href = "index.html";

  const { data: profile } = await db
    .from("profiles")
    .select("*")
    .eq("id", user.id)
    .single();

  if (profile) {
    document.getElementById("title").innerText = "Edit Profile";
    name.value = profile.name;
    age.value = profile.age;
    income.value = profile.income;
    gender.value = profile.gender;
    caste.value = profile.caste;
    state.value = profile.state;
  }
}

async function saveProfile() {
  const { data: { user } } = await db.auth.getUser();

  const profile = {
    id: user.id,
    name: name.value,
    age: parseInt(age.value),
    income: parseInt(income.value),
    gender: gender.value,
    caste: caste.value,
    state: state.value
  };

  const { error } = await db.from("profiles").upsert(profile);

  if (error) {
    alert("Error saving profile");
    console.error(error);
    return;
  }

  window.location.href = "schemes.html";
}

async function logout() {
  await db.auth.signOut();
  location.href = "index.html";
}

loadProfile();
</script>

</body>
</html>
